#######################################################################################
###
### br_je_princely_league_main effects
###
#######################################################################################
#This effect will do the nessesary set up for the stances feature of the left side faction
br_princely_league_main_set_up_left_side_stances = {
	# Set up the var's needed to count the nr of countries that support each stance
	scope:com_situation = {	#needs to be 'scope:journal_entry' and not a je: direct scope is because the direct scope is inaccessible in the immediate block of a JE
		set_variable = {
			name = br_princely_league_main_nr_of_independence_stance_members_var
			value = 0
		}
		set_variable = {
			name = br_princely_league_main_nr_of_autonomy_stance_members_var
			value = 0
		}

		#temporatily init it here will do this differently later on
		set_variable = {
			name = br_princely_league_main_nr_of_left_side_members_var
			value = 0
		}
	}
}

#This effect will change the stance of the member country in who's scope this is called to independence
br_princely_league_main_left_side_member_change_stance_to_independence = {
	set_variable = {
		name = br_princely_league_main_left_side_member_stance_var
		value = flag:br_princely_league_main_independence_stance_flag
	}

	scope:com_situation = {
		change_variable = {
			name = br_princely_league_main_nr_of_independence_stance_members_var
			add = 1
		}
	}
}

#This effect will change the stance of the member country in who's scope this is called to autonomy
br_princely_league_main_left_side_member_change_stance_to_autonomy = {
	set_variable = {
		name = br_princely_league_main_left_side_member_stance_var
		value = flag:br_princely_league_main_autonomy_stance_flag
	}

	scope:com_situation = {
		change_variable = {
			name = br_princely_league_main_nr_of_autonomy_stance_members_var
			add = 1
		}
	}
}

#Establishes a Princely League Membership treaty between a given 'first_country' and 'second_country'
br_princely_league_main_establish_a_princely_league_membership_treaty = {
	create_treaty = {
		name = br_princely_league_membership_treaty_name
		first_country = $first_country$
		second_country = $second_country$

		is_draft = no
		# binding_period = { years = 0 }

		articles_to_create = {
			{ # Princely League Membership
				article = br_princely_league_membership
			}
		}
	}
}

#Establishes a Princely League Membership treaty between all other countries currently in the Princely League
#root is expected to be a country scope
br_princely_league_main_establish_a_princely_league_membership_treaty_with_all_countries_currently_in_the_league = {
	#First get access to the scope:com_situation for all of the situation effects to work correctly
	save_com_situation_scope = {
		situation_id = br_princely_league_situation_id
	}
	every_com_situation_countries  = {
		if = {
			limit = {
				not = { this ?= root }
				or = {
					is_com_situation_faction_member = {
						side = left
						faction = br_princely_league_left_faction_members
					}
					is_com_situation_side_leader = {
						side = left
					}
				}
			}
			br_princely_league_main_establish_a_princely_league_membership_treaty = {
				first_country = root
				second_country = this
			}
		}
	}
}

#Remove a Princely League Membership treaty between a given 'first_country' and 'second_country'
br_princely_league_main_remove_princely_league_membership_treaty = {
	$first_country$ = {
		every_scope_treaty = {
			limit = {
				$second_country$ ?= second_country
				any_scope_article = {
					has_type = br_princely_league_membership
				}
			}
			$first_country$ = {
				set_variable = br_can_withdraw_from_princely_league_membership_treaty
			}
			withdraw = {
				country = $first_country$
			}
		}
	}
}

# br_princely_league_main_remove_a_princely_league_membership_treaty = {
# 	first_country = c:BRI
# 	second_country = c:FLA
# }

#Remove a Princely League Membership treaty between all other countries currently in the Princely League
#root is expected to be a country scope
br_princely_league_main_remove_princely_league_membership_treaty_with_all_countries_currently_in_the_league = {
	#First get access to the scope:com_situation for all of the situation effects to work correctly
	save_com_situation_scope = {
		situation_id = br_princely_league_situation_id
	}
	every_com_situation_countries  = {
		if = {
			limit = {
				not = { this ?= root }
				or = {
					is_com_situation_faction_member = {
						side = left
						faction = br_princely_league_left_faction_members
					}
					is_com_situation_side_leader = {
						side = left
					}
				}
			}
			#need to save scope because giving this as argument (to a macro) to causes the wrong scope to be used in the called scripted effect
			save_temporary_scope_as = br_princely_league_second_country
			br_princely_league_main_remove_princely_league_membership_treaty = {
				first_country = root
				second_country = scope:br_princely_league_second_country
			}
		}
	}
}