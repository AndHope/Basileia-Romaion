enforce_treaty_of_poznan = {
	if = {
		limit = {
			has_global_variable = br_request_poznan_global_var
		}
		if = {
			limit = {
				scope:br_commonwealth_scope = {
					any_scope_state = {
						state_region = s:STATE_POSEN
					}
				}
			}
			scope:br_commonwealth_scope = {
				random_scope_state = {
					limit = {
						state_region = s:STATE_POSEN
					}
					set_state_owner = scope:br_north_german_federation_scope
				}
			}
		}
		scope:br_north_german_federation_scope = {
			take_on_scaled_debt = {
				who = scope:br_commonwealth_scope
				value = 0.25
			}	
		}
	}
	if = {
		limit = {
			has_global_variable = br_request_pomorze_global_var
		}
		if = {
			limit = {
				scope:br_commonwealth_scope = {
					any_scope_state = {
						state_region = s:STATE_WEST_PRUSSIA
					}
				}
			}
			scope:br_commonwealth_scope = {
				random_scope_state = {
					limit = {
						state_region = s:STATE_WEST_PRUSSIA
					}
					set_state_owner = scope:br_north_german_federation_scope
				}
			}
			scope:br_north_german_federation_scope = {
				take_on_scaled_debt = {
					who = scope:br_commonwealth_scope
					value = 0.25
				}	
			}
		}
	}
	if = {
		limit = {
			has_global_variable = br_fate_of_prussia_global_var
		}
		if = { #do this first so it doesn't conflict with the other effects
			limit = { 
				has_variable = br_propose_prussian_annexation_of_memel_var
			}
			br_prussian_annexation_of_memel_scripted_effect = yes
		}
		if = {
			limit = { 
				has_variable = br_propose_independence_of_prussia_var
			}
			br_prussia_independent_scripted_effect = yes
		}
		else_if = {
			limit = { 
				has_variable = br_propose_plc_subjugation_of_prussia_var
			}
			br_plc_subjugation_of_prussia_var_scripted_effect = yes
		}
		else_if = {
			limit = { 
				has_variable = br_propose_ngf_subjugation_of_prussia_var
			}
			br_ngf_subjugation_of_prussia_scripted_effect = yes
		}
		else_if = {
			limit = { 
				has_variable = br_propose_plc_annexation_of_prussia_var
			}
			br_plc_annexation_of_prussia_scripted_effect = yes
		}
		else_if = {
			limit = { 
				has_variable = br_propose_ngf_annexation_of_prussia_var
			}
			br_ngf_annexation_of_prussia_scripted_effect = yes
		}
	}
	if = {
		limit = {
			has_global_variable = br_counter_offer_global_var
		}

		#TODO
		if = {
			limit = {
				exists = c:LUX
			}
			s:STATE_WALLONIA = {
				set_owner_of_provinces = {
					country = c:LUX
					provinces = {
						x5180a0 x3a5fb9
					}
				}
			}
		}
		else = {
			s:STATE_WALLONIA = {
				set_owner_of_provinces = {
					country = c:NET
					provinces = {
						x5180a0 x3a5fb9
					}
				}
			}
		}
	}
}

br_extend_the_poznan_conference_scripted_effect = {
	change_global_variable = {
		name = br_je_conference_of_poznan_timer
		add = $NUMBER_OF_MONTHS$ 		#extend the deadline with a couple of months
	}
}

br_conclude_the_poznan_conference_scripted_effect = {
	limit = {
		NOT = {
			has_global_variable = br_poznan_treaty_will_conclude_global_var
		}
	}
	set_global_variable = br_poznan_treaty_will_conclude_global_var
}

br_remove_treaty_of_poznan_variables_scripted_effect = {
	if = {
		limit = { 
			this ?= scope:br_north_german_federation_scope
		}
		remove_global_variable = br_je_conference_of_poznan_timer
		remove_global_variable = br_poznan_conference_initiator
		remove_global_variable = br_poznan_conference_target

		remove_global_variable = br_je_conference_of_poznan_proposal_1
		remove_global_variable = br_je_conference_of_poznan_proposal_2
		remove_global_variable = br_je_conference_of_poznan_proposal_3
		remove_global_variable = br_je_conference_of_poznan_proposal_4

		if = {
			limit = {
				has_global_variable = br_poznan_treaty_signed_plc_global_var
			}
			remove_global_variable = br_poznan_treaty_signed_plc_global_var
		}
		if = {
			limit = {
				has_global_variable = br_poznan_treaty_signed_ngf_global_var
			}
			remove_global_variable = br_poznan_treaty_signed_ngf_global_var
		}
		if = {
			limit = {
				has_global_variable = br_request_poznan_global_var
			}
			remove_global_variable = br_request_poznan_global_var
		}
		if = {
			limit = {
				has_global_variable = br_request_pomorze_global_var
			}
			remove_global_variable = br_request_pomorze_global_var
		}
		if = {
			limit = {
				has_global_variable = br_poznan_treaty_has_concluded_global_var
			}
			remove_global_variable = br_poznan_treaty_has_concluded_global_var
		}

		br_remove_all_prussian_fate_variables_scripted_effect = yes
	}
}


#Prussian fate event
br_remove_prussian_fate_variables_scripted_effect = {
	remove_variable = br_propose_independence_of_prussia_var
	remove_variable = br_propose_plc_subjugation_of_prussia_var
	remove_variable = br_propose_ngf_subjugation_of_prussia_var
	remove_variable = br_propose_plc_annexation_of_prussia_var
	remove_variable = br_propose_ngf_annexation_of_prussia_var
	# remove_variable = br_propose_prussian_annexation_of_memel_var #this one is not removed because it is not mutualy exclusive with the others
}

br_remove_all_prussian_fate_variables_scripted_effect = {
	br_remove_prussian_fate_variables_scripted_effect = yes
	remove_variable = br_propose_prussian_annexation_of_memel_var
}

#prussia becomes independent
br_prussia_independent_scripted_effect = {
	scope:br_commonwealth_scope ?= {
		remove_diplomatic_pact = {  
			country = c:PRU 
			type = dominion #TODO find a way to make the type generic
		}
	}
}

#plc puppets prussia
br_plc_subjugation_of_prussia_var_scripted_effect = {
	scope:br_commonwealth_scope ?= {
		create_diplomatic_pact = {
			country = c:PRU
			type = puppet
		}
	}
}

#ngf puppets prussia
br_ngf_subjugation_of_prussia_scripted_effect = {
	scope:br_north_german_federation_scope ?= {
		create_diplomatic_pact = {
			country = c:PRU
			type = puppet
		}
	}
}

#plc annexes prussia
br_plc_annexation_of_prussia_scripted_effect = {
	scope:br_commonwealth_scope ?= {
		annex = c:PRU
	}
}

#nfg annexes prussia
br_ngf_annexation_of_prussia_scripted_effect = {
	scope:br_north_german_federation_scope ?= {
		annex = c:PRU
	}
}

#give prussia memel
br_prussian_annexation_of_memel_scripted_effect = {
	c:PRU ?= {
		s:STATE_EAST_PRUSSIA = {
			random_scope_state = {
				limit = {
					owner = scope:br_commonwealth_scope
				}
				set_state_owner = c:PRU
			}
		}
	}
}