je_religion_swap = {
	icon = "gfx/interface/icons/law_icons/total_separation.dds"
	
	group = je_group_historical_content

	#triggered thru br_generic_religion_swap_decision

	scripted_progress_bar = br_religious_conversion_progress_bar

	#add scripted buttons to increase the convertion

	immediate = {
		#save the scopes to the religions and set the new religion
		root.religion = {
			save_scope_as = old_state_religion
		}
		br_swap_religion_effect = yes
		root.religion = {
			save_scope_as = new_state_religion
		}

		#trigger events after the religion scopes are saved
		trigger_event = br_religion_swap_events.1
		
		add_modifier = {
			name = br_modifier_swapping_religion
			months = -1
		}
	}

	complete = {
		custom_tooltip = {
			scope:journal_entry = { #in the scope journal_entrie because custom_tooltip is at the country scope level
				scripted_bar_progress = {
					name = br_religious_conversion_progress_bar
					value >= 0.5	#50%
				}
			}
			text = je_religion_swap_complete
		}
	}

	on_complete = {
		remove_modifier = br_modifier_swapping_religion
		add_modifier = {
			name = br_modifier_swaped_religion_succesfully
			years = 5
		}
		trigger_event = br_religion_swap_events.2
	}

	fail = {
		scope:new_state_religion = {
			not = {
				is_state_religion = root
			}
		}
	}
	
	on_fail = {
		remove_modifier = br_modifier_swapping_religion
		add_modifier = {
			name = br_modifier_swaped_religion_failure
			years = 5
		}
		trigger_event = br_religion_swap_events.3
	}	
 
	

	on_monthly_pulse = {
		effect = {
			#calculate the percentage of pops that follow the new religion
			set_local_variable = {
				name  = total_religion
				value = 0
			}
			set_local_variable = {
				name  = total_pops
				value = 0
			}
			every_scope_pop = {
				change_local_variable = {
					name = total_pops
					add  = total_size #need to get the total pop size of the root country
				}
				if = {
					limit = {
						religion = scope:new_state_religion # or whatever
					}
					change_local_variable = {
						name = total_religion
						add  = total_size
					}
				}
			}
			set_local_variable = {
				name  = country_religion_share
				value = {
					add    = local_var:total_religion
					divide = local_var:total_pops
				}
			}
			# use local_var:country_religion_share

			scope:journal_entry = {
				set_bar_progress = {
					value = local_var:country_religion_share
					name = br_religious_conversion_progress_bar
				}
			}
		}

		random_events = { #can't get the event trigger chance right
			chance_of_no_event = { 	# An entry that can be formatted as a script value (and therefore have conditional entries). Separated from "chance_to_happen" for performance reasons. Will only be evaluated if chance_to_happen is true.
				value = 100
				add = -1
			}

			100 = br_religion_swap_events.4
		}
	}
	
	status_desc = {
		first_valid = {
			triggered_desc = { 
				desc = je_religion_swap_status
			}
		}
	}

	timeout = 5475	#15 years

	on_timeout = {
		#add
	}

	weight = 1000
	should_be_pinned_by_default = yes
}